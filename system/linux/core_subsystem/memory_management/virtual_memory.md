# Linux 虚拟内存的实现

Linux 没有使用不同数据结构分别描述进程和线程，而是使用 `task_struct` 数据结构统一描述一个执行的任务（这样看起来更加优雅，毕竟对于内核来说都是一个要调度的单位），其属性 `struct mm_struct  *mm` 表示该线程的地址空间，使用同一地址空间的 Task 属于同一进程。

- 指向同一个 mm 的 Task 属于同一进程。不同进程使用不同的 `struct mm_struct`。

- 内核线程对应的 task_struct 结构中的 mm 域指向 Null，所以内核线程之间调度是不涉及地址空间切换的。

当一个内核线程被调度时，它会发现自己的虚拟地址空间为 Null，而是直接复用上一个用户态线程的虚拟地址空间（相当于在当前用户线程所在的进程执行任务），这样做有很多好处，可以避免内核线程之间调度时地址空间的切换开销。最重要的是由于地址空间没有变化，避免了缓存失效，大大提高了运行速度。


**父进程与子进程的区别，进程与线程的区别，以及内核线程与用户态线程的区别其实都是围绕着这个 mm_struct 展开的。**